# AI 工具调用事件调试计划

## 问题分析
在 `aiCommandExecutor.js` 中发送的 `ai-tool-call-complete` 事件，在 `CommandExecution.vue` 组件中没有收到。

## 可能原因
1. **时序问题**: 事件发送时组件可能还未挂载
2. **事件冒泡问题**: CustomEvent 可能没有正确冒泡到 window
3. **事件监听器问题**: 监听器可能没有正确绑定或被移除
4. **组件生命周期问题**: 组件可能在事件发送前已卸载
5. **事件数据格式问题**: 事件详情可能没有正确传递

## 调试步骤

### 1. 添加详细的事件调试日志
- 在 `aiCommandExecutor.js` 的 `dispatchEvent` 方法中添加更详细的日志
- 在 `CommandExecution.vue` 的事件监听器中添加调试日志
- 记录事件发送和接收的完整时间线

### 2. 验证事件发送机制
- 确认 CustomEvent 正确创建
- 验证 `window.dispatchEvent` 是否成功调用
- 检查事件是否真的被发送到 window

### 3. 验证事件监听机制
- 确认组件确实在事件发送前已挂载
- 验证事件监听器是否正确绑定到 window
- 检查是否有其他代码移除了监听器

### 4. 检查组件生命周期
- 记录组件挂载和卸载的时间
- 确认事件发送时组件处于活跃状态
- 检查组件是否因为路由变化等原因被卸载

### 5. 验证事件数据匹配
- 确认事件的 `toolCallId` 与组件期望的 ID 匹配
- 检查事件详情是否正确传递
- 验证事件处理逻辑是否正确

## 实施计划
1. 首先添加详细的调试日志
2. 创建一个测试页面来验证事件机制
3. 分析日志输出找出根本原因
4. 修复发现的问题
5. 验证修复效果
