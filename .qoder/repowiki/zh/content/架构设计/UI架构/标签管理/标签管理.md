# æ ‡ç­¾ç®¡ç†

<cite>
**Referenced Files in This Document**  
- [TabManager.vue](file://src/components/TabManager.vue)
- [TabBar.vue](file://src/components/tabs/TabBar.vue)
- [WelcomeScreen.vue](file://src/components/tabs/WelcomeScreen.vue)
- [ConnectionContent.vue](file://src/components/tabs/ConnectionContent.vue)
- [useConnectionManager.ts](file://src/composables/useConnectionManager.ts)
- [useTerminalManager.ts](file://src/modules/terminal/composables/useTerminalManager.ts)
</cite>

## ç›®å½•
1. [å¼•è¨€](#å¼•è¨€)
2. [æ ¸å¿ƒçŠ¶æ€ç®¡ç†](#æ ¸å¿ƒçŠ¶æ€ç®¡ç†)
3. [æ ‡ç­¾æ ç»„ä»¶](#æ ‡ç­¾æ ç»„ä»¶)
4. [æ¬¢è¿ç•Œé¢](#æ¬¢è¿ç•Œé¢)
5. [è¿æ¥å†…å®¹æ¸²æŸ“](#è¿æ¥å†…å®¹æ¸²æŸ“)
6. [ç»„åˆå¼å‡½æ•°é›†æˆ](#ç»„åˆå¼å‡½æ•°é›†æˆ)
7. [äº‹ä»¶æµåˆ†æ](#äº‹ä»¶æµåˆ†æ)
8. [å¼‚å¸¸å¤„ç†ä¸èµ„æºæ¸…ç†](#å¼‚å¸¸å¤„ç†ä¸èµ„æºæ¸…ç†)

## å¼•è¨€
æœ¬æ–‡æ¡£æ·±å…¥è§£æå¤šæ ‡ç­¾ä¼šè¯ç®¡ç†ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶TabManagerï¼Œå…¨é¢é˜è¿°å…¶æ¶æ„è®¾è®¡ä¸å®ç°æœºåˆ¶ã€‚ç³»ç»Ÿé€šè¿‡å“åº”å¼çŠ¶æ€ç®¡ç†å®ç°æ ‡ç­¾é¡µçš„åŠ¨æ€æ¸²æŸ“ä¸åˆ‡æ¢ï¼Œä¸ºç”¨æˆ·æä¾›é«˜æ•ˆçš„SSHè¿œç¨‹è¿æ¥ç®¡ç†ä½“éªŒã€‚æ–‡æ¡£å°†è¯¦ç»†è¯´æ˜activeConnectionså’ŒactiveTabIdçŠ¶æ€å¦‚ä½•é©±åŠ¨æ•´ä¸ªæ ‡ç­¾ç³»ç»Ÿï¼Œåˆ†æTabBarã€WelcomeScreenå’ŒConnectionContentç­‰æ ¸å¿ƒç»„ä»¶çš„äº¤äº’é€»è¾‘ï¼Œå¹¶æ­ç¤ºuseConnectionManagerå’ŒuseTerminalManagerç­‰ç»„åˆå¼å‡½æ•°å¦‚ä½•é›†æˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚

## æ ¸å¿ƒçŠ¶æ€ç®¡ç†
æ ‡ç­¾ç®¡ç†ç³»ç»Ÿçš„æ ¸å¿ƒåœ¨äºä¸¤ä¸ªå“åº”å¼çŠ¶æ€ï¼šactiveConnectionså’ŒactiveTabIdã€‚è¿™ä¸¤ä¸ªçŠ¶æ€ç”±useConnectionManagerç»„åˆå¼å‡½æ•°æä¾›ï¼Œä½œä¸ºæ•´ä¸ªæ ‡ç­¾ç³»ç»Ÿæ•°æ®æµçš„æºå¤´ã€‚

```mermaid
classDiagram
class useConnectionManager {
+activeConnections : Ref<Connection[]>
+activeTabId : Ref<string | null>
+addConnection(sessionData)
+switchTab(connectionId)
+closeConnection(connectionId)
+disconnectConnection(connectionId)
+reconnectConnection(connection)
+cancelConnection(connectionId)
}
class TabManager {
-useConnectionManager : Composition
-useTerminalManager : Composition
-usePanelManager : Composition
-useContextMenu : Composition
}
useConnectionManager --> TabManager : "provides"
```

**activeConnections**æ˜¯ä¸€ä¸ªå“åº”å¼æ•°ç»„ï¼Œå­˜å‚¨æ‰€æœ‰æ´»åŠ¨çš„SSHè¿æ¥å¯¹è±¡ã€‚æ¯ä¸ªè¿æ¥å¯¹è±¡åŒ…å«è¿æ¥IDã€åç§°ã€ä¸»æœºã€ç«¯å£ã€ç”¨æˆ·åã€è®¤è¯æ–¹å¼ã€è¿æ¥çŠ¶æ€ã€ç»ˆç«¯è¾“å‡ºç­‰å…³é”®ä¿¡æ¯ã€‚è¯¥çŠ¶æ€çš„å˜æ›´ä¼šè‡ªåŠ¨è§¦å‘UIçš„é‡æ–°æ¸²æŸ“ã€‚

**activeTabId**æ˜¯ä¸€ä¸ªå“åº”å¼å­—ç¬¦ä¸²ï¼Œæ ‡è¯†å½“å‰æ¿€æ´»çš„æ ‡ç­¾é¡µIDã€‚å½“ç”¨æˆ·åˆ‡æ¢æ ‡ç­¾æˆ–åˆ›å»ºæ–°è¿æ¥æ—¶ï¼Œè¯¥å€¼ä¼šæ›´æ–°ï¼Œä»è€Œé©±åŠ¨ConnectionContentç»„ä»¶æ˜¾ç¤ºå¯¹åº”è¿æ¥çš„å†…å®¹ã€‚

è¿™äº›çŠ¶æ€é€šè¿‡ç»„åˆå¼å‡½æ•°è¢«TabManagerç»„ä»¶ä½¿ç”¨ï¼Œå®ç°äº†çŠ¶æ€ä¸UIçš„è§£è€¦ï¼Œä½¿å¾—çŠ¶æ€ç®¡ç†é€»è¾‘å¯ä»¥è¢«å¤šä¸ªç»„ä»¶å¤ç”¨ã€‚

**Section sources**
- [useConnectionManager.ts](file://src/composables/useConnectionManager.ts#L12-L13)
- [TabManager.vue](file://src/components/TabManager.vue#L100-L105)

## æ ‡ç­¾æ ç»„ä»¶
TabBarç»„ä»¶è´Ÿè´£æ ‡ç­¾é¡µçš„å¯è§†åŒ–å±•ç¤ºä¸ç”¨æˆ·äº¤äº’ï¼Œæ˜¯ç”¨æˆ·æ“ä½œæ ‡ç­¾çš„ä¸»è¦ç•Œé¢ã€‚

```mermaid
sequenceDiagram
participant User as "ç”¨æˆ·"
participant TabBar as "TabBarç»„ä»¶"
participant TabManager as "TabManagerç»„ä»¶"
participant ConnectionManager as "useConnectionManager"
User->>TabBar : ç‚¹å‡»æ ‡ç­¾
TabBar->>TabManager : emit switch-tabäº‹ä»¶
TabManager->>ConnectionManager : è°ƒç”¨switchTabæ–¹æ³•
ConnectionManager->>ConnectionManager : æ›´æ–°activeTabId
ConnectionManager-->>TabManager : è¿”å›
TabManager-->>TabBar : activeTabIdå˜æ›´
TabBar-->>User : é«˜äº®æ˜¾ç¤ºå½“å‰æ ‡ç­¾
User->>TabBar : ç‚¹å‡»å…³é—­æŒ‰é’®
TabBar->>TabManager : emit close-connectionäº‹ä»¶
TabManager->>ConnectionManager : è°ƒç”¨closeConnectionæ–¹æ³•
ConnectionManager->>ConnectionManager : æ‰§è¡Œè¿æ¥å…³é—­é€»è¾‘
ConnectionManager-->>TabManager : è¿”å›
TabManager-->>TabBar : activeConnectionså˜æ›´
TabBar-->>User : ç§»é™¤å¯¹åº”æ ‡ç­¾
```

TabBarç»„ä»¶æ¥æ”¶æ¥è‡ªTabManagerçš„connectionså’ŒactiveTabIdå±æ€§ï¼Œé€šè¿‡v-foræŒ‡ä»¤åŠ¨æ€æ¸²æŸ“æ ‡ç­¾åˆ—è¡¨ã€‚æ¯ä¸ªæ ‡ç­¾æ˜¾ç¤ºè¿æ¥åç§°ã€çŠ¶æ€å›¾æ ‡å’Œå…³é—­æŒ‰é’®ã€‚çŠ¶æ€å›¾æ ‡ä½¿ç”¨ä¸åŒçš„emojiè¡¨ç¤ºè¿æ¥çŠ¶æ€ï¼šè¿æ¥ä¸­(â³)ã€å·²è¿æ¥(ğŸŸ¢)ã€è¿æ¥å¤±è´¥(âŒ)ã€å·²æ–­å¼€(ğŸ”Œ)ã€‚

ç”¨æˆ·äº¤äº’é€šè¿‡äº‹ä»¶å‘å°„å™¨å®ç°ï¼š
- ç‚¹å‡»æ ‡ç­¾è§¦å‘`switch-tab`äº‹ä»¶ï¼Œé€šçŸ¥TabManageråˆ‡æ¢åˆ°æŒ‡å®šæ ‡ç­¾
- ç‚¹å‡»å…³é—­æŒ‰é’®è§¦å‘`close-connection`äº‹ä»¶ï¼Œé€šçŸ¥TabManagerå…³é—­æŒ‡å®šè¿æ¥
- ç‚¹å‡»"æ–°å»ºè¿æ¥"æŒ‰é’®è§¦å‘`open-session-modal`äº‹ä»¶ï¼Œæ‰“å¼€è¿æ¥åˆ›å»ºæ¨¡æ€æ¡†

å½“æ²¡æœ‰æ´»åŠ¨è¿æ¥æ—¶ï¼ŒTabBaræ˜¾ç¤º"æš‚æ— è¿æ¥"çš„æç¤ºä¿¡æ¯å’Œ"åˆ›å»ºç¬¬ä¸€ä¸ªè¿æ¥"çš„æŒ‰é’®ï¼Œå¼•å¯¼ç”¨æˆ·åˆ›å»ºæ–°è¿æ¥ã€‚

**Section sources**
- [TabBar.vue](file://src/components/tabs/TabBar.vue#L1-L263)
- [TabManager.vue](file://src/components/TabManager.vue#L10-L20)

## æ¬¢è¿ç•Œé¢
WelcomeScreenç»„ä»¶åœ¨æ— æ´»åŠ¨è¿æ¥æ—¶æ˜¾ç¤ºï¼Œæä¾›ç”¨æˆ·å¼•å¯¼å’ŒåŠŸèƒ½ä»‹ç»ã€‚

```mermaid
flowchart TD
Start([åº”ç”¨å¯åŠ¨]) --> CheckConnections["æ£€æŸ¥activeConnectionsé•¿åº¦"]
CheckConnections --> |é•¿åº¦ä¸º0| ShowWelcomeScreen["æ˜¾ç¤ºWelcomeScreen"]
ShowWelcomeScreen --> DisplayHero["æ˜¾ç¤ºè‹±é›„åŒºåŸŸ"]
DisplayHero --> DisplayFeatures["æ˜¾ç¤ºåŠŸèƒ½ç‰¹æ€§"]
DisplayFeatures --> DisplayStats["æ˜¾ç¤ºè¿æ¥ç»Ÿè®¡"]
DisplayStats --> DisplayActions["æ˜¾ç¤ºæ“ä½œæŒ‰é’®"]
DisplayActions --> WaitUserAction["ç­‰å¾…ç”¨æˆ·æ“ä½œ"]
WaitUserAction --> |ç‚¹å‡»åˆ›å»ºè¿æ¥| EmitOpenModal["å‘å°„open-session-modaläº‹ä»¶"]
EmitOpenModal --> End([è¿æ¥åˆ›å»ºæµç¨‹])
CheckConnections --> |é•¿åº¦å¤§äº0| ShowTabContent["æ˜¾ç¤ºConnectionContent"]
ShowTabContent --> End
```

WelcomeScreené‡‡ç”¨ç°ä»£åŒ–çš„UIè®¾è®¡ï¼ŒåŒ…å«ä»¥ä¸‹ä¸»è¦åŒºåŸŸï¼š
- **è‹±é›„åŒºåŸŸ**ï¼šæ˜¾ç¤ºåº”ç”¨Logoã€æ ‡é¢˜"SSH Remote"å’Œæ ‡è¯­"ä¼ä¸šçº§SSHè¿œç¨‹è¿æ¥ç®¡ç†å¹³å°"
- **åŠŸèƒ½ç‰¹æ€§åŒºåŸŸ**ï¼šå±•ç¤ºå…­ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼ˆå®‰å…¨è®¤è¯ã€å®Œæ•´ç»ˆç«¯ã€æ–‡ä»¶ç®¡ç†ã€AIåŠ©æ‰‹ã€å¿«é€Ÿè¿æ¥ã€é…ç½®ä¿å­˜ï¼‰
- **ç»Ÿè®¡ä¿¡æ¯åŒºåŸŸ**ï¼šæ˜¾ç¤ºå·²ä¿å­˜è¿æ¥æ•°é‡å’Œæœ€åè¿æ¥æ—¶é—´
- **æ“ä½œæŒ‰é’®åŒºåŸŸ**ï¼šæä¾›"åˆ›å»ºè¿æ¥"å’Œ"ä½¿ç”¨æŒ‡å—"æŒ‰é’®

å½“ç”¨æˆ·ç‚¹å‡»"åˆ›å»ºè¿æ¥"æŒ‰é’®æ—¶ï¼Œç»„ä»¶å‘å°„`open-session-modal`äº‹ä»¶ï¼Œè§¦å‘è¿æ¥åˆ›å»ºæµç¨‹ã€‚ç‚¹å‡»"ä½¿ç”¨æŒ‡å—"æŒ‰é’®ä¼šæ˜¾ç¤ºå¸®åŠ©æ¨¡æ€æ¡†ï¼Œè¯¦ç»†ä»‹ç»åº”ç”¨çš„ä½¿ç”¨æ–¹æ³•ã€‚

**Section sources**
- [WelcomeScreen.vue](file://src/components/tabs/WelcomeScreen.vue#L1-L799)
- [TabManager.vue](file://src/components/TabManager.vue#L25-L30)

## è¿æ¥å†…å®¹æ¸²æŸ“
ConnectionContentç»„ä»¶æ ¹æ®å½“å‰æ¿€æ´»çš„æ ‡ç­¾åŠ¨æ€æ¸²æŸ“å¯¹åº”çš„è¿æ¥å†…å®¹ã€‚

```mermaid
classDiagram
class ConnectionContent {
+connections : Array
+activeTabId : String
+panelWidths : Object
+isResizing : Boolean
+contextMenu : Object
}
class ThreePanelLayout {
+connection : Object
+panelWidths : Object
+isResizing : Boolean
}
class ConnectingState {
+connection : Object
}
class ConnectionFailedState {
+connection : Object
}
class DisconnectedState {
+connection : Object
}
class ConnectionStatusBar {
+connection : Object
}
ConnectionContent --> ThreePanelLayout : "v-show"
ConnectionContent --> ConnectingState : "v-else-if"
ConnectionContent --> ConnectionFailedState : "v-else-if"
ConnectionContent --> DisconnectedState : "v-else-if"
ConnectionContent --> ConnectionStatusBar : "v-if"
```

è¯¥ç»„ä»¶é€šè¿‡v-foræŒ‡ä»¤éå†æ‰€æœ‰è¿æ¥ï¼Œä½†ä»…æ˜¾ç¤ºactiveTabIdåŒ¹é…çš„è¿æ¥ã€‚æ ¹æ®è¿æ¥çŠ¶æ€ï¼Œç»„ä»¶ä¼šæ¸²æŸ“ä¸åŒçš„å­ç»„ä»¶ï¼š
- **connectedçŠ¶æ€**ï¼šæ¸²æŸ“ThreePanelLayoutï¼ˆä¸‰é¢æ¿å¸ƒå±€ï¼‰å’ŒConnectionStatusBarï¼ˆè¿æ¥çŠ¶æ€æ ï¼‰
- **connectingçŠ¶æ€**ï¼šæ¸²æŸ“ConnectingStateï¼ˆè¿æ¥ä¸­çŠ¶æ€ï¼‰
- **failedçŠ¶æ€**ï¼šæ¸²æŸ“ConnectionFailedStateï¼ˆè¿æ¥å¤±è´¥çŠ¶æ€ï¼‰
- **disconnectedçŠ¶æ€**ï¼šæ¸²æŸ“DisconnectedStateï¼ˆå·²æ–­å¼€è¿æ¥çŠ¶æ€ï¼‰

è¿™ç§æ¡ä»¶æ¸²æŸ“æœºåˆ¶ç¡®ä¿äº†ç”¨æˆ·ç•Œé¢å§‹ç»ˆåæ˜ å½“å‰è¿æ¥çš„çœŸå®çŠ¶æ€ã€‚ç»„ä»¶é€šè¿‡äº‹ä»¶å‘å°„å™¨å°†ç”¨æˆ·æ“ä½œï¼ˆå¦‚æ‰§è¡Œå‘½ä»¤ã€æ¸…ç©ºç»ˆç«¯ã€å¤åˆ¶å†…å®¹ç­‰ï¼‰ä¼ é€’ç»™TabManagerï¼Œå®ç°äº†ç»„ä»¶é—´çš„è§£è€¦ã€‚

**Section sources**
- [ConnectionContent.vue](file://src/components/tabs/ConnectionContent.vue#L1-L145)
- [TabManager.vue](file://src/components/TabManager.vue#L32-L88)

## ç»„åˆå¼å‡½æ•°é›†æˆ
TabManagerç»„ä»¶é€šè¿‡å¤šä¸ªç»„åˆå¼å‡½æ•°é›†æˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œå®ç°äº†åŠŸèƒ½çš„æ¨¡å—åŒ–å’Œå¤ç”¨ã€‚

```mermaid
classDiagram
class TabManager {
-useConnectionManager : Composition
-useTerminalManager : Composition
-usePanelManager : Composition
-useContextMenu : Composition
}
class useConnectionManager {
+addConnection()
+switchTab()
+closeConnection()
+disconnectConnection()
+reconnectConnection()
+cancelConnection()
+startConnectionMonitoring()
+stopConnectionMonitoring()
+startSystemMonitoring()
+stopSystemMonitoring()
}
class useTerminalManager {
+executeCommand()
+clearTerminal()
+copyTerminalContent()
+handleTerminalKeydown()
+handleTerminalInput()
+handleTerminalFocus()
+handleTerminalBlur()
+handleAutocompleteSelect()
+handleAutocompleteHide()
+setAutocompleteRef()
+addTerminalOutput()
+scrollToBottom()
}
class usePanelManager {
+startResize()
+handleMouseMove()
+handleMouseUp()
+resetPanelWidths()
}
class useContextMenu {
+handleTerminalContextMenu()
+handleTerminalMouseUp()
+handleTerminalSelectStart()
+hideContextMenu()
+updateContextMenuPosition()
+handleContextMenuCopy()
+handleContextMenuAddToAI()
+handleContextMenuSelectAll()
}
useConnectionManager --> TabManager : "provides"
useTerminalManager --> TabManager : "provides"
usePanelManager --> TabManager : "provides"
useContextMenu --> TabManager : "provides"
```

**useConnectionManager**æ˜¯æ ¸å¿ƒçŠ¶æ€ç®¡ç†å‡½æ•°ï¼Œæä¾›è¿æ¥çš„å¢åˆ æ”¹æŸ¥ã€çŠ¶æ€ç›‘æ§ã€ç³»ç»Ÿä¿¡æ¯æ›´æ–°ç­‰åŠŸèƒ½ã€‚å®ƒç»´æŠ¤activeConnectionså’ŒactiveTabIdä¸¤ä¸ªå“åº”å¼çŠ¶æ€ï¼Œæ˜¯æ•´ä¸ªæ ‡ç­¾ç³»ç»Ÿæ•°æ®æµçš„æºå¤´ã€‚

**useTerminalManager**è´Ÿè´£ç»ˆç«¯ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼ŒåŒ…æ‹¬å‘½ä»¤æ‰§è¡Œã€ç»ˆç«¯è¾“å‡ºå¤„ç†ã€ANSIè½¬ä¹‰åºåˆ—è½¬æ¢ã€æ»šåŠ¨æ§åˆ¶ã€å¤åˆ¶åŠŸèƒ½ç­‰ã€‚å®ƒä¸useConnectionManagerååŒå·¥ä½œï¼Œä¸ºç”¨æˆ·æä¾›å®Œæ•´çš„ç»ˆç«¯ä½“éªŒã€‚

**usePanelManager**ç®¡ç†ä¸‰é¢æ¿å¸ƒå±€çš„å®½åº¦è°ƒæ•´ï¼Œå¤„ç†é¼ æ ‡äº‹ä»¶ï¼Œå®ç°ç”¨æˆ·å¯¹æ–‡ä»¶ã€ç»ˆç«¯ã€AIé¢æ¿çš„è‡ªå®šä¹‰å¸ƒå±€ã€‚

**useContextMenu**å¤„ç†å³é”®èœå•çš„æ˜¾ç¤ºä¸äº¤äº’ï¼Œæ”¯æŒå¤åˆ¶ã€é€‰æ‹©å…¨éƒ¨ã€æ·»åŠ åˆ°AIåŠ©æ‰‹ç­‰æ“ä½œã€‚

è¿™äº›ç»„åˆå¼å‡½æ•°é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼è¢«TabManagerä½¿ç”¨ï¼Œå®ç°äº†å…³æ³¨ç‚¹åˆ†ç¦»ï¼Œæé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ã€‚

**Section sources**
- [TabManager.vue](file://src/components/TabManager.vue#L100-L140)
- [useConnectionManager.ts](file://src/composables/useConnectionManager.ts#L10-L538)
- [useTerminalManager.ts](file://src/modules/terminal/composables/useTerminalManager.ts#L3-L268)

## äº‹ä»¶æµåˆ†æ
æ ‡ç­¾ç³»ç»Ÿçš„å®Œæ•´äº‹ä»¶æµä»ç”¨æˆ·äº¤äº’å¼€å§‹ï¼Œç»è¿‡ç»„ä»¶é—´ä¼ é€’ï¼Œæœ€ç»ˆç”±ç»„åˆå¼å‡½æ•°å¤„ç†ã€‚

```mermaid
sequenceDiagram
participant User as "ç”¨æˆ·"
participant TabBar as "TabBar"
participant TabManager as "TabManager"
participant ConnectionManager as "useConnectionManager"
participant TerminalManager as "useTerminalManager"
participant ElectronAPI as "ElectronAPI"
User->>TabBar : ç‚¹å‡»"æ–°å»ºè¿æ¥"
TabBar->>TabManager : emit open-session-modal
TabManager->>User : æ˜¾ç¤ºè¿æ¥æ¨¡æ€æ¡†
User->>TabManager : æäº¤è¿æ¥ä¿¡æ¯
TabManager->>ConnectionManager : è°ƒç”¨addConnection
ConnectionManager->>ConnectionManager : åˆ›å»ºè¿æ¥å¯¹è±¡
ConnectionManager->>ConnectionManager : è®¾ç½®çŠ¶æ€ä¸ºconnecting
ConnectionManager->>ElectronAPI : è°ƒç”¨sshConnect
ElectronAPI-->>ConnectionManager : è¿”å›è¿æ¥ç»“æœ
alt è¿æ¥æˆåŠŸ
ConnectionManager->>ConnectionManager : è®¾ç½®çŠ¶æ€ä¸ºconnected
ConnectionManager->>ConnectionManager : å¯åŠ¨è¿æ¥ç›‘æ§
ConnectionManager->>ConnectionManager : å¯åŠ¨ç³»ç»Ÿç›‘æ§
ConnectionManager->>TabManager : activeConnectionså˜æ›´
TabManager->>User : æ˜¾ç¤ºæ–°æ ‡ç­¾é¡µ
else è¿æ¥å¤±è´¥
ConnectionManager->>ConnectionManager : è®¾ç½®çŠ¶æ€ä¸ºfailed
ConnectionManager->>TabManager : activeConnectionså˜æ›´
TabManager->>User : æ˜¾ç¤ºè¿æ¥å¤±è´¥çŠ¶æ€
end
User->>TabBar : ç‚¹å‡»æ ‡ç­¾åˆ‡æ¢
TabBar->>TabManager : emit switch-tab
TabManager->>ConnectionManager : è°ƒç”¨switchTab
ConnectionManager->>ConnectionManager : æ›´æ–°activeTabId
ConnectionManager-->>TabManager : è¿”å›
TabManager->>ConnectionContent : activeTabIdå˜æ›´
ConnectionContent->>User : æ¸²æŸ“å¯¹åº”è¿æ¥å†…å®¹
User->>ConnectionContent : è¾“å…¥å‘½ä»¤å¹¶å›è½¦
ConnectionContent->>TabManager : emit execute-command
TabManager->>TerminalManager : è°ƒç”¨executeCommand
TerminalManager->>ElectronAPI : è°ƒç”¨sshExecute
ElectronAPI-->>TerminalManager : è¿”å›å‘½ä»¤ç»“æœ
TerminalManager->>ConnectionManager : è°ƒç”¨addTerminalOutput
ConnectionManager->>ConnectionManager : æ·»åŠ è¾“å‡ºåˆ°terminalOutput
ConnectionManager-->>TerminalManager : è¿”å›
TerminalManager->>TerminalManager : æ»šåŠ¨åˆ°åº•éƒ¨
TerminalManager-->>TabManager : è¿”å›
TabManager->>User : æ˜¾ç¤ºå‘½ä»¤è¾“å‡º
```

ä»¥æ ‡ç­¾åˆ›å»ºä¸ºä¾‹ï¼Œäº‹ä»¶æµå¦‚ä¸‹ï¼š
1. ç”¨æˆ·åœ¨TabBarç‚¹å‡»"æ–°å»ºè¿æ¥"æŒ‰é’®
2. TabBarå‘å°„`open-session-modal`äº‹ä»¶
3. TabManageræ¥æ”¶äº‹ä»¶å¹¶æ˜¾ç¤ºè¿æ¥åˆ›å»ºæ¨¡æ€æ¡†
4. ç”¨æˆ·å¡«å†™è¿æ¥ä¿¡æ¯å¹¶æäº¤
5. TabManagerè°ƒç”¨useConnectionManagerçš„addConnectionæ–¹æ³•
6. useConnectionManageråˆ›å»ºè¿æ¥å¯¹è±¡å¹¶è°ƒç”¨ElectronAPIå»ºç«‹SSHè¿æ¥
7. è¿æ¥æˆåŠŸåï¼Œæ›´æ–°activeConnectionsçŠ¶æ€
8. çŠ¶æ€å˜æ›´è§¦å‘UIé‡æ–°æ¸²æŸ“ï¼Œæ˜¾ç¤ºæ–°æ ‡ç­¾é¡µ

æ ‡ç­¾åˆ‡æ¢å’Œå‘½ä»¤æ‰§è¡Œçš„äº‹ä»¶æµéµå¾ªç±»ä¼¼çš„æ¨¡å¼ï¼Œä½“ç°äº†æ¸…æ™°çš„å•å‘æ•°æ®æµè®¾è®¡ã€‚

**Section sources**
- [TabManager.vue](file://src/components/TabManager.vue#L10-L88)
- [useConnectionManager.ts](file://src/composables/useConnectionManager.ts#L31-L79)
- [useTerminalManager.ts](file://src/modules/terminal/composables/useTerminalManager.ts#L10-L30)

## å¼‚å¸¸å¤„ç†ä¸èµ„æºæ¸…ç†
ç³»ç»Ÿåœ¨å¼‚å¸¸å¤„ç†å’Œèµ„æºæ¸…ç†æ–¹é¢æœ‰å®Œå–„çš„ç­–ç•¥ï¼Œç¡®ä¿åº”ç”¨çš„ç¨³å®šæ€§å’Œèµ„æºçš„æœ‰æ•ˆç®¡ç†ã€‚

```mermaid
flowchart TD
A[è¿æ¥å¼‚å¸¸] --> B{å¼‚å¸¸ç±»å‹}
B --> |è¿æ¥å¤±è´¥| C[è®¾ç½®çŠ¶æ€ä¸ºfailed]
C --> D[æ·»åŠ é”™è¯¯è¾“å‡ºåˆ°terminalOutput]
D --> E[æ˜¾ç¤ºé€šçŸ¥]
B --> |è¿æ¥ä¸¢å¤±| F[è®¾ç½®çŠ¶æ€ä¸ºdisconnected]
F --> G[æ·»åŠ è­¦å‘Šè¾“å‡ºåˆ°terminalOutput]
G --> H[æ˜¾ç¤ºé€šçŸ¥]
B --> |å‘½ä»¤æ‰§è¡Œå¼‚å¸¸| I[æ·»åŠ é”™è¯¯è¾“å‡ºåˆ°terminalOutput]
I --> J[ä½¿ç”¨storeè®°å½•å‘½ä»¤å¤±è´¥]
J --> K[æ˜¾ç¤ºé€šçŸ¥]
L[ç»„ä»¶å¸è½½] --> M[åœæ­¢è¿æ¥ç›‘æ§]
M --> N[åœæ­¢ç³»ç»Ÿç›‘æ§]
N --> O[ç§»é™¤äº‹ä»¶ç›‘å¬å™¨]
O --> P[æ¸…ç†è¿æ¥æ± ]
Q[å…³é—­è¿æ¥] --> R[æ–­å¼€SSHè¿æ¥]
R --> S[å…³é—­è¿æ¥æ± ]
S --> T[ä»activeConnectionsç§»é™¤]
T --> U[åˆ‡æ¢activeTabId]
```

**å¼‚å¸¸å¤„ç†ç­–ç•¥**ï¼š
- **è¿æ¥å¤±è´¥**ï¼šæ•è·è¿æ¥å¼‚å¸¸ï¼Œè®¾ç½®è¿æ¥çŠ¶æ€ä¸º'failed'ï¼Œåœ¨ç»ˆç«¯è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œå¹¶æ˜¾ç¤ºé€šçŸ¥
- **è¿æ¥ä¸¢å¤±**ï¼šé€šè¿‡å¿ƒè·³æ£€æµ‹å‘ç°è¿æ¥ä¸¢å¤±ï¼Œè®¾ç½®çŠ¶æ€ä¸º'disconnected'ï¼Œé€šçŸ¥ç”¨æˆ·
- **å‘½ä»¤æ‰§è¡Œå¼‚å¸¸**ï¼šæ•è·å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å¼‚å¸¸ï¼Œåœ¨ç»ˆç«¯æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œå¹¶è®°å½•åˆ°ç»ˆç«¯store
- **ElectronAPIä¸å¯ç”¨**ï¼šæ£€æŸ¥ElectronAPIæ˜¯å¦å­˜åœ¨ï¼Œé¿å…åœ¨éElectronç¯å¢ƒä¸­è¿è¡Œæ—¶å‡ºç°é”™è¯¯

**èµ„æºæ¸…ç†ç­–ç•¥**ï¼š
- **ç»„ä»¶å¸è½½æ—¶**ï¼šåœ¨onUnmountedé’©å­ä¸­åœæ­¢æ‰€æœ‰è¿æ¥ç›‘æ§å’Œç³»ç»Ÿç›‘æ§ï¼Œç§»é™¤äº‹ä»¶ç›‘å¬å™¨ï¼Œæ¸…ç†è¿æ¥æ± 
- **å…³é—­è¿æ¥æ—¶**ï¼šå…ˆæ–­å¼€SSHè¿æ¥ï¼Œå†å…³é—­è¿æ¥æ± ï¼Œæœ€åä»activeConnectionsä¸­ç§»é™¤è¿æ¥å¯¹è±¡
- **åˆ‡æ¢æ ‡ç­¾æ—¶**ï¼šæ›´æ–°è¿æ¥çš„æœ€åæ´»åŠ¨æ—¶é—´ï¼Œç”¨äºè¿æ¥è¶…æ—¶ç®¡ç†
- **å†…å­˜ç®¡ç†**ï¼šé™åˆ¶ç»ˆç«¯è¾“å‡ºå†å²è®°å½•ä¸º1000æ¡ï¼Œè¶…è¿‡åä¿ç•™æœ€è¿‘500æ¡ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼

è¿™äº›ç­–ç•¥ç¡®ä¿äº†ç³»ç»Ÿåœ¨å„ç§å¼‚å¸¸æƒ…å†µä¸‹éƒ½èƒ½ä¼˜é›…åœ°å¤„ç†ï¼Œé¿å…èµ„æºæ³„æ¼å’ŒçŠ¶æ€ä¸ä¸€è‡´çš„é—®é¢˜ã€‚

**Section sources**
- [useConnectionManager.ts](file://src/composables/useConnectionManager.ts#L311-L349)
- [TabManager.vue](file://src/components/TabManager.vue#L260-L270)
- [useTerminalManager.ts](file://src/modules/terminal/composables/useTerminalManager.ts#L100-L120)