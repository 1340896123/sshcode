# æ ‡ç­¾ç®¡ç†

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨æ–‡ä»¶**   
- [TabManager.vue](file://src/components/TabManager.vue)
- [useConnectionManager.ts](file://src/composables/useConnectionManager.ts)
- [TabBar.vue](file://src/components/tabs/TabBar.vue)
- [ConnectionStatusBar.vue](file://src/components/connection/ConnectionStatusBar.vue)
- [ConnectingState.vue](file://src/components/connection/ConnectingState.vue)
- [ConnectionFailedState.vue](file://src/components/connection/ConnectionFailedState.vue)
- [DisconnectedState.vue](file://src/components/connection/DisconnectedState.vue)
- [ConnectionContent.vue](file://src/components/tabs/ConnectionContent.vue)
- [useSSHConnectionPool.js](file://src/composables/useSSHConnectionPool.js)
- [index.ts](file://src/types/index.ts)
- [terminal.ts](file://src/types/terminal.ts)
- [WelcomeScreen.vue](file://src/components/tabs/WelcomeScreen.vue)
</cite>

## ç›®å½•
1. [æ ‡ç­¾ç®¡ç†ç»„ä»¶æ¶æ„](#æ ‡ç­¾ç®¡ç†ç»„ä»¶æ¶æ„)
2. [è¿æ¥ç®¡ç†ç»„åˆå¼å‡½æ•°å®ç°](#è¿æ¥ç®¡ç†ç»„åˆå¼å‡½æ•°å®ç°)
3. [æ ‡ç­¾æ è§†è§‰å‘ˆç°æœºåˆ¶](#æ ‡ç­¾æ è§†è§‰å‘ˆç°æœºåˆ¶)
4. [é«˜çº§äº¤äº’åŠŸèƒ½å®ç°](#é«˜çº§äº¤äº’åŠŸèƒ½å®ç°)
5. [æ ‡ç­¾çŠ¶æ€æŒä¹…åŒ–æ–¹æ¡ˆ](#æ ‡ç­¾çŠ¶æ€æŒä¹…åŒ–æ–¹æ¡ˆ)
6. [çˆ¶å­ç»„ä»¶é€šä¿¡æœºåˆ¶](#çˆ¶å­ç»„ä»¶é€šä¿¡æœºåˆ¶)
7. [å¤šæ ‡ç­¾å¹¶å‘çŠ¶æ€åŒæ­¥](#å¤šæ ‡ç­¾å¹¶å‘çŠ¶æ€åŒæ­¥)
8. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)

## æ ‡ç­¾ç®¡ç†ç»„ä»¶æ¶æ„

æ ‡ç­¾ç®¡ç†åŠŸèƒ½ç”±`TabManager.vue`ç»„ä»¶ä½œä¸ºæ ¸å¿ƒå®¹å™¨ï¼Œé€šè¿‡ç»„åˆå¼å‡½æ•°`useConnectionManager`ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ ‡ç­¾é¡µçš„ç”Ÿå‘½å‘¨æœŸã€‚è¯¥ç»„ä»¶é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œå°†æ ‡ç­¾æ ã€å†…å®¹åŒºåŸŸå’Œå³é”®èœå•åˆ†ç¦»ä¸ºç‹¬ç«‹ç»„ä»¶ï¼Œé€šè¿‡äº‹ä»¶é©±åŠ¨æœºåˆ¶è¿›è¡Œé€šä¿¡ã€‚

```mermaid
graph TD
TabManager[TabManager ç»„ä»¶] --> TabBar[TabBar ç»„ä»¶]
TabManager --> ConnectionContent[ConnectionContent ç»„ä»¶]
TabManager --> ContextMenu[ContextMenu ç»„ä»¶]
TabManager --> useConnectionManager[useConnectionManager ç»„åˆå¼å‡½æ•°]
useConnectionManager --> useSSHConnectionPool[useSSHConnectionPool è¿æ¥æ± ]
ConnectionContent --> ConnectingState[ConnectingState çŠ¶æ€ç»„ä»¶]
ConnectionContent --> ConnectionFailedState[ConnectionFailedState çŠ¶æ€ç»„ä»¶]
ConnectionContent --> DisconnectedState[DisconnectedState çŠ¶æ€ç»„ä»¶]
ConnectionContent --> ConnectionStatusBar[ConnectionStatusBar çŠ¶æ€æ ]
```

**å›¾è¡¨æ¥æº**
- [TabManager.vue](file://src/components/TabManager.vue#L1-L363)
- [ConnectionContent.vue](file://src/components/tabs/ConnectionContent.vue#L1-L144)

## è¿æ¥ç®¡ç†ç»„åˆå¼å‡½æ•°å®ç°

`useConnectionManager`ç»„åˆå¼å‡½æ•°æ˜¯æ ‡ç­¾ç®¡ç†çš„æ ¸å¿ƒé€»è¾‘å•å…ƒï¼Œè´Ÿè´£å¤„ç†æ ‡ç­¾çš„åˆ›å»ºã€æ¿€æ´»ã€åˆ‡æ¢å’Œå…³é—­ç­‰æ“ä½œã€‚è¯¥å‡½æ•°é€šè¿‡å“åº”å¼å¼•ç”¨ç®¡ç†è¿æ¥çŠ¶æ€ï¼Œæä¾›å®Œæ•´çš„è¿æ¥ç”Ÿå‘½å‘¨æœŸæ§åˆ¶ã€‚

### æ ‡ç­¾åˆ›å»ºä¸è¿æ¥å»ºç«‹

å½“ç”¨æˆ·åˆ›å»ºæ–°è¿æ¥æ—¶ï¼Œ`addConnection`æ–¹æ³•è¢«è°ƒç”¨ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«å®Œæ•´è¿æ¥ä¿¡æ¯çš„å“åº”å¼å¯¹è±¡ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°`activeConnections`æ•°ç»„ä¸­ã€‚éšåè°ƒç”¨`establishConnection`æ–¹æ³•å¯åŠ¨SSHè¿æ¥è¿‡ç¨‹ã€‚

```mermaid
sequenceDiagram
participant UI as ç”¨æˆ·ç•Œé¢
participant TabManager as TabManagerç»„ä»¶
participant ConnectionManager as useConnectionManager
participant ElectronAPI as ElectronAPI
UI->>TabManager : åˆ›å»ºè¿æ¥è¯·æ±‚
TabManager->>ConnectionManager : addConnection(sessionData)
ConnectionManager->>ConnectionManager : åˆ›å»ºConnectionå¯¹è±¡
ConnectionManager->>ConnectionManager : æ·»åŠ åˆ°activeConnections
ConnectionManager->>ConnectionManager : è®¾ç½®activeTabId
ConnectionManager->>ConnectionManager : establishConnection
ConnectionManager->>ElectronAPI : sshConnect(connectionParams)
ElectronAPI-->>ConnectionManager : è¿”å›è¿æ¥ç»“æœ
alt è¿æ¥æˆåŠŸ
ConnectionManager->>ConnectionManager : æ›´æ–°çŠ¶æ€ä¸ºconnected
ConnectionManager->>ConnectionManager : åˆ›å»ºæŒä¹…è¿æ¥æ± 
ConnectionManager->>ConnectionManager : å¯åŠ¨ç›‘æ§å®šæ—¶å™¨
else è¿æ¥å¤±è´¥
ConnectionManager->>ConnectionManager : æ›´æ–°çŠ¶æ€ä¸ºfailed
ConnectionManager->>ConnectionManager : è®°å½•é”™è¯¯ä¿¡æ¯
end
ConnectionManager->>TabManager : å‘é€é€šçŸ¥äº‹ä»¶
```

**å›¾è¡¨æ¥æº**
- [useConnectionManager.ts](file://src/composables/useConnectionManager.ts#L10-L538)
- [TabManager.vue](file://src/components/TabManager.vue#L1-L363)

### æ ‡ç­¾åˆ‡æ¢ä¸æ¿€æ´»

`switchTab`æ–¹æ³•è´Ÿè´£å¤„ç†æ ‡ç­¾åˆ‡æ¢é€»è¾‘ï¼Œæ›´æ–°`activeTabId`çš„å€¼ä»¥æ¿€æ´»æŒ‡å®šæ ‡ç­¾é¡µã€‚è¯¥æ–¹æ³•åŒæ—¶æ›´æ–°è¿æ¥çš„æœ€åæ´»åŠ¨æ—¶é—´ï¼Œç”¨äºä¼šè¯ç®¡ç†å’Œè¶…æ—¶æ§åˆ¶ã€‚

```mermaid
flowchart TD
Start([å¼€å§‹åˆ‡æ¢æ ‡ç­¾]) --> UpdateActiveTab["æ›´æ–°activeTabIdå€¼"]
UpdateActiveTab --> FindConnection["æŸ¥æ‰¾ç›®æ ‡è¿æ¥å¯¹è±¡"]
FindConnection --> UpdateLastActivity["æ›´æ–°è¿æ¥çš„lastActivityæ—¶é—´"]
UpdateLastActivity --> EmitNotification["å‘é€åˆ‡æ¢é€šçŸ¥"]
EmitNotification --> End([æ ‡ç­¾åˆ‡æ¢å®Œæˆ])
```

**å›¾è¡¨æ¥æº**
- [useConnectionManager.ts](file://src/composables/useConnectionManager.ts#L394-L404)

### æ ‡ç­¾å…³é—­ä¸èµ„æºæ¸…ç†

`closeConnection`æ–¹æ³•å®ç°äº†å®Œæ•´çš„æ ‡ç­¾å…³é—­æµç¨‹ï¼ŒåŒ…æ‹¬æ–­å¼€è¿æ¥ã€æ¸…ç†èµ„æºå’Œæ›´æ–°UIçŠ¶æ€ã€‚è¯¥æ–¹æ³•ç¡®ä¿åœ¨å…³é—­æ ‡ç­¾å‰æ­£ç¡®é‡Šæ”¾æ‰€æœ‰ç›¸å…³èµ„æºã€‚

```mermaid
flowchart TD
Start([å¼€å§‹å…³é—­è¿æ¥]) --> CheckStatus["æ£€æŸ¥è¿æ¥çŠ¶æ€"]
CheckStatus --> IsConnected{"çŠ¶æ€ä¸ºconnected?"}
IsConnected --> |æ˜¯| Disconnect["è°ƒç”¨disconnectConnection"]
IsConnected --> |å¦| SkipDisconnect["è·³è¿‡æ–­å¼€æ­¥éª¤"]
Disconnect --> ClosePool["å…³é—­è¿æ¥æ± ä¸­çš„æŒä¹…è¿æ¥"]
SkipDisconnect --> ClosePool
ClosePool --> RemoveFromList["ä»activeConnectionsç§»é™¤"]
RemoveFromList --> UpdateActiveTab["æ›´æ–°activeTabId"]
UpdateActiveTab --> HasRemaining{"è¿˜æœ‰å‰©ä½™è¿æ¥?"}
HasRemaining --> |æ˜¯| SwitchToLast["åˆ‡æ¢åˆ°æœ€åä¸€ä¸ªè¿æ¥"]
HasRemaining --> |å¦| ClearActiveTab["æ¸…ç©ºactiveTabId"]
SwitchToLast --> End([è¿æ¥å…³é—­å®Œæˆ])
ClearActiveTab --> End
```

**å›¾è¡¨æ¥æº**
- [useConnectionManager.ts](file://src/composables/useConnectionManager.ts#L455-L498)

## æ ‡ç­¾æ è§†è§‰å‘ˆç°æœºåˆ¶

`TabBar.vue`ç»„ä»¶è´Ÿè´£æ ‡ç­¾æ çš„è§†è§‰å‘ˆç°ï¼Œé€šè¿‡åŠ¨æ€æ¸²æŸ“è¿æ¥çŠ¶æ€å›¾æ ‡å’Œäº¤äº’å…ƒç´ ï¼Œä¸ºç”¨æˆ·æä¾›ç›´è§‚çš„çŠ¶æ€åé¦ˆã€‚

### è¿æ¥çŠ¶æ€å›¾æ ‡åŠ¨æ€æ¸²æŸ“

æ ‡ç­¾æ ä½¿ç”¨`getConnectionIcon`æ–¹æ³•æ ¹æ®è¿æ¥çŠ¶æ€åŠ¨æ€æ˜¾ç¤ºç›¸åº”çš„å›¾æ ‡ï¼Œé€šè¿‡CSSç±»ç»‘å®šå®ç°çŠ¶æ€æ ·å¼çš„åŠ¨æ€åˆ‡æ¢ã€‚

```mermaid
classDiagram
class TabBar {
+connections : Array
+activeTabId : String
-getConnectionIcon(connection) : String
+switchTab(connectionId)
+closeConnection(connectionId)
}
class Connection {
+id : String
+name : String
+status : String
+host : String
+username : String
}
TabBar --> Connection : "æ˜¾ç¤º"
note right of TabBar
è¿æ¥çŠ¶æ€æ˜ å°„ï¼š
connecting â†’ â³
connected â†’ ğŸŸ¢
failed â†’ âŒ
disconnected â†’ ğŸ”Œ
end note
```

**å›¾è¡¨æ¥æº**
- [TabBar.vue](file://src/components/tabs/TabBar.vue#L1-L262)

### çŠ¶æ€æŒ‡ç¤ºå™¨æ ·å¼

æ ‡ç­¾çŠ¶æ€é€šè¿‡`.tab-status`å…ƒç´ çš„CSSç±»ç»‘å®šå®ç°åŠ¨æ€æ ·å¼ï¼Œä¸åŒçŠ¶æ€å¯¹åº”ä¸åŒçš„èƒŒæ™¯é¢œè‰²å’ŒåŠ¨ç”»æ•ˆæœã€‚

```mermaid
stateDiagram-v2
[*] --> connecting
connecting --> connected : è¿æ¥æˆåŠŸ
connecting --> failed : è¿æ¥å¤±è´¥
connected --> disconnected : æ‰‹åŠ¨æ–­å¼€
connected --> failed : è¿æ¥ä¸¢å¤±
disconnected --> connecting : é‡æ–°è¿æ¥
failed --> connecting : é‡è¯•è¿æ¥
state connecting {
style : background : #f59e0b; animation : pulse 1.5s infinite
}
state connected {
style : background : #10b981
}
state failed {
style : background : #ef4444
}
state disconnected {
style : background : #6b7280
}
```

**å›¾è¡¨æ¥æº**
- [TabBar.vue](file://src/components/tabs/TabBar.vue#L1-L262)
- [ConnectionStatusBar.vue](file://src/components/connection/ConnectionStatusBar.vue#L1-L250)

## é«˜çº§äº¤äº’åŠŸèƒ½å®ç°

### æ‹–æ‹½æ’åºåŠŸèƒ½

è™½ç„¶å½“å‰ä»£ç ä¸­æœªç›´æ¥å®ç°æ‹–æ‹½æ’åºåŠŸèƒ½ï¼Œä½†ç³»ç»Ÿæ¶æ„ä¸ºè¯¥åŠŸèƒ½çš„å®ç°æä¾›äº†åŸºç¡€ã€‚é€šè¿‡ç›‘å¬é¼ æ ‡äº‹ä»¶å’Œè°ƒæ•´`activeConnections`æ•°ç»„çš„é¡ºåºï¼Œå¯ä»¥å®ç°æ ‡ç­¾çš„æ‹–æ‹½æ’åºã€‚

### åŒå‡»å…³é—­åŠŸèƒ½

åŒå‡»å…³é—­åŠŸèƒ½å¯é€šè¿‡åœ¨`TabBar.vue`çš„æ ‡ç­¾é¡¹ä¸Šæ·»åŠ åŒå‡»äº‹ä»¶ç›‘å¬å™¨å®ç°ã€‚å½“ç”¨æˆ·åŒå‡»æ ‡ç­¾æ—¶ï¼Œè§¦å‘`closeConnection`äº‹ä»¶ã€‚

### å³é”®èœå•åŠŸèƒ½

å³é”®èœå•åŠŸèƒ½ç”±`ContextMenu.vue`ç»„ä»¶å®ç°ï¼Œé€šè¿‡`useContextMenu`ç»„åˆå¼å‡½æ•°ç®¡ç†èœå•çŠ¶æ€å’Œä½ç½®ã€‚å½“ç”¨æˆ·åœ¨ç»ˆç«¯åŒºåŸŸå³é”®ç‚¹å‡»æ—¶ï¼Œæ˜¾ç¤ºåŒ…å«å¤åˆ¶ã€æ·»åŠ åˆ°AIç­‰é€‰é¡¹çš„ä¸Šä¸‹æ–‡èœå•ã€‚

```mermaid
sequenceDiagram
participant Terminal as ç»ˆç«¯åŒºåŸŸ
participant TabManager as TabManagerç»„ä»¶
participant ContextMenu as ContextMenuç»„ä»¶
Terminal->>TabManager : handleTerminalContextMenu
TabManager->>ContextMenu : æ˜¾ç¤ºèœå•(visible=true)
TabManager->>ContextMenu : è®¾ç½®ä½ç½®(x,y)
TabManager->>ContextMenu : è®¾ç½®é€‰ä¸­æ–‡æœ¬
ContextMenu->>User : æ˜¾ç¤ºå³é”®èœå•
User->>ContextMenu : é€‰æ‹©èœå•é¡¹
ContextMenu->>TabManager : è§¦å‘ç›¸åº”äº‹ä»¶
TabManager->>Terminal : æ‰§è¡Œå¯¹åº”æ“ä½œ
```

**å›¾è¡¨æ¥æº**
- [TabManager.vue](file://src/components/TabManager.vue#L1-L363)
- [ContextMenu.vue](file://src/components/ContextMenu.vue#L1-L100)

## æ ‡ç­¾çŠ¶æ€æŒä¹…åŒ–æ–¹æ¡ˆ

### ä¼šè¯æ¢å¤æœºåˆ¶

ç³»ç»Ÿé€šè¿‡ElectronAPIçš„`getSessions`æ–¹æ³•è·å–æœ€è¿‘çš„ä¼šè¯åˆ—è¡¨ï¼Œåœ¨`WelcomeScreen.vue`ç»„ä»¶ä¸­æ˜¾ç¤ºã€‚è™½ç„¶å½“å‰å®ç°ä¸»è¦åœ¨æ¬¢è¿ç•Œé¢å±•ç¤ºï¼Œä½†è¯¥æœºåˆ¶å¯æ‰©å±•ç”¨äºé‡å¯åè‡ªåŠ¨æ¢å¤ä¼šè¯ã€‚

```mermaid
flowchart TD
Start([åº”ç”¨å¯åŠ¨]) --> LoadSessions["è°ƒç”¨getSessionsè·å–ä¼šè¯"]
LoadSessions --> HasSessions{"æœ‰ä¼šè¯è®°å½•?"}
HasSessions --> |æ˜¯| DisplayRecent["æ˜¾ç¤ºæœ€è¿‘ä¼šè¯"]
HasSessions --> |å¦| ShowEmpty["æ˜¾ç¤ºç©ºçŠ¶æ€"]
DisplayRecent --> AutoConnect["å¯é€‰ï¼šè‡ªåŠ¨è¿æ¥æœ€è¿‘ä¼šè¯"]
AutoConnect --> End([åˆå§‹åŒ–å®Œæˆ])
```

**å›¾è¡¨æ¥æº**
- [WelcomeScreen.vue](file://src/components/tabs/WelcomeScreen.vue#L1-L799)

### æŒä¹…è¿æ¥æ± 

`useSSHConnectionPool`ç»„åˆå¼å‡½æ•°å®ç°äº†æŒä¹…è¿æ¥æ± æœºåˆ¶ï¼Œé€šè¿‡Mapæ•°æ®ç»“æ„ç»´æŠ¤æ´»åŠ¨è¿æ¥ï¼Œæ”¯æŒæ‰¹é‡å‘½ä»¤æ‰§è¡Œå’Œè¿æ¥å¥åº·æ£€æŸ¥ã€‚

```mermaid
classDiagram
class useSSHConnectionPool {
+connectionPool : Map
+commandQueue : Map
+executingCommands : Set
+createPersistentConnection()
+executeBatchCommand()
+checkConnectionHealth()
+closePersistentConnection()
+getConnectionStatus()
+startCleanupTimer()
}
class PoolEntry {
+id : String
+connectionParams : Object
+status : String
+lastUsed : Number
+commandHistory : Array
+errorCount : Number
+lastError : String
+isExecuting : Boolean
+commandBuffer : Array
}
useSSHConnectionPool --> PoolEntry : "åˆ›å»º"
note right of useSSHConnectionPool
è¿æ¥æ± åŠŸèƒ½ï¼š
- æŒä¹…åŒ–SSHè¿æ¥
- æ‰¹é‡æ‰§è¡Œç³»ç»Ÿç›‘æ§å‘½ä»¤
- è¿æ¥å¥åº·æ£€æŸ¥
- å®šæœŸæ¸…ç†è¶…æ—¶è¿æ¥
end note
```

**å›¾è¡¨æ¥æº**
- [useSSHConnectionPool.js](file://src/composables/useSSHConnectionPool.js#L1-L259)

## çˆ¶å­ç»„ä»¶é€šä¿¡æœºåˆ¶

### emitäº‹ä»¶é€šä¿¡

ç»„ä»¶é—´é€šè¿‡`emit`äº‹ä»¶è¿›è¡Œé€šä¿¡ï¼Œ`TabManager.vue`ä½œä¸ºçˆ¶ç»„ä»¶æ¥æ”¶å­ç»„ä»¶äº‹ä»¶å¹¶è°ƒç”¨ç›¸åº”æ–¹æ³•ã€‚

```mermaid
sequenceDiagram
participant TabBar as TabBarç»„ä»¶
participant TabManager as TabManagerç»„ä»¶
participant ConnectionManager as useConnectionManager
TabBar->>TabManager : switch-tabäº‹ä»¶
TabManager->>ConnectionManager : è°ƒç”¨switchTabæ–¹æ³•
TabBar->>TabManager : close-connectionäº‹ä»¶
TabManager->>ConnectionManager : è°ƒç”¨closeConnectionæ–¹æ³•
TabBar->>TabManager : open-session-modaläº‹ä»¶
TabManager->>çˆ¶ç»„ä»¶ : é€ä¼ open-session-modaläº‹ä»¶
ConnectionContent->>TabManager : reconnect-connectionäº‹ä»¶
TabManager->>ConnectionManager : è°ƒç”¨reconnectConnectionæ–¹æ³•
ConnectionContent->>TabManager : cancel-connectionäº‹ä»¶
TabManager->>ConnectionManager : è°ƒç”¨cancelConnectionæ–¹æ³•
```

**å›¾è¡¨æ¥æº**
- [TabManager.vue](file://src/components/TabManager.vue#L1-L363)
- [TabBar.vue](file://src/components/tabs/TabBar.vue#L1-L262)

### äº‹ä»¶å¤„ç†æµç¨‹

å…³é”®äº‹ä»¶çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š

```mermaid
flowchart TD
EventStart([äº‹ä»¶è§¦å‘]) --> EventPropagation["äº‹ä»¶å†’æ³¡åˆ°TabManager"]
EventPropagation --> MethodCall["è°ƒç”¨useConnectionManageræ–¹æ³•"]
MethodCall --> StateUpdate["æ›´æ–°å“åº”å¼çŠ¶æ€"]
StateUpdate --> SideEffects["æ‰§è¡Œå‰¯ä½œç”¨æ“ä½œ"]
SideEffects --> EmitNotification["å‘é€show-notificationäº‹ä»¶"]
EmitNotification --> UIUpdate["æ›´æ–°UIç•Œé¢"]
UIUpdate --> End([äº‹ä»¶å¤„ç†å®Œæˆ])
```

**å›¾è¡¨æ¥æº**
- [TabManager.vue](file://src/components/TabManager.vue#L1-L363)

## å¤šæ ‡ç­¾å¹¶å‘çŠ¶æ€åŒæ­¥

### çŠ¶æ€åŒæ­¥æœºåˆ¶

ç³»ç»Ÿé€šè¿‡å“åº”å¼å¼•ç”¨å’Œè®¡ç®—å±æ€§å®ç°å¤šæ ‡ç­¾çŠ¶æ€çš„è‡ªåŠ¨åŒæ­¥ã€‚`activeConnections`å’Œ`activeTabId`ä½œä¸ºå“åº”å¼å¼•ç”¨ï¼Œå½“å…¶å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰€æœ‰ä¾èµ–è¿™äº›çŠ¶æ€çš„ç»„ä»¶ä¼šè‡ªåŠ¨æ›´æ–°ã€‚

### å¹¶å‘æ“ä½œå¤„ç†

å¯¹äºå¹¶å‘æ“ä½œï¼Œç³»ç»Ÿé‡‡ç”¨ä¸²è¡ŒåŒ–å¤„ç†ç­–ç•¥ï¼Œé€šè¿‡Promiseé“¾ç¡®ä¿æ“ä½œçš„åŸå­æ€§ã€‚ä¾‹å¦‚ï¼Œåœ¨å…³é—­è¿æ¥æ—¶ï¼Œå…ˆæ–­å¼€SSHè¿æ¥ï¼Œå†å…³é—­è¿æ¥æ± ï¼Œæœ€åä»è¿æ¥åˆ—è¡¨ä¸­ç§»é™¤ã€‚

```mermaid
sequenceDiagram
participant User1 as ç”¨æˆ·1
participant User2 as ç”¨æˆ·2
participant TabManager as TabManagerç»„ä»¶
User1->>TabManager : è¯·æ±‚å…³é—­è¿æ¥A
User2->>TabManager : è¯·æ±‚å…³é—­è¿æ¥A
TabManager->>TabManager : æ’é˜Ÿå¤„ç†è¯·æ±‚
TabManager->>TabManager : ç¬¬ä¸€ä¸ªè¯·æ±‚å¤„ç†ä¸­
TabManager->>User1 : å¤„ç†ä¸­...
TabManager->>User2 : ç­‰å¾…...
TabManager->>TabManager : ç¬¬ä¸€ä¸ªè¯·æ±‚å®Œæˆ
TabManager->>User1 : å®Œæˆ
TabManager->>TabManager : ç¬¬äºŒä¸ªè¯·æ±‚å¤„ç†
TabManager->>User2 : è¿æ¥ä¸å­˜åœ¨
```

**å›¾è¡¨æ¥æº**
- [useConnectionManager.ts](file://src/composables/useConnectionManager.ts#L10-L538)

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### è¿æ¥ç›‘æ§ä¼˜åŒ–

ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚ç›‘æ§ç­–ç•¥ï¼Œå¯¹ä¸åŒçŠ¶æ€çš„è¿æ¥é‡‡ç”¨ä¸åŒçš„ç›‘æ§é¢‘ç‡ï¼š

```mermaid
flowchart TD
Start([è¿æ¥çŠ¶æ€]) --> Connected{"çŠ¶æ€ä¸ºconnected?"}
Connected --> |æ˜¯| StartSystemMonitor["å¯åŠ¨ç³»ç»Ÿç›‘æ§(1ç§’é—´éš”)"]
Connected --> |å¦| StartConnectionMonitor["å¯åŠ¨è¿æ¥ç›‘æ§(30ç§’é—´éš”)"]
StartSystemMonitor --> UpdateSystemInfo["è°ƒç”¨updateSystemInfo"]
StartConnectionMonitor --> CheckHealth["è°ƒç”¨checkConnectionHealth"]
UpdateSystemInfo --> UseConnectionPool{"ä½¿ç”¨è¿æ¥æ± ?"}
UseConnectionPool --> |æ˜¯| ExecuteBatch["æ‰§è¡Œæ‰¹é‡å‘½ä»¤"]
UseConnectionPool --> |å¦| ExecuteSingle["æ‰§è¡Œå•ä¸ªå‘½ä»¤"]
ExecuteBatch --> ProcessData["å¤„ç†ç³»ç»Ÿæ•°æ®"]
ProcessData --> UpdateUI["æ›´æ–°UIæ˜¾ç¤º"]
CheckHealth --> SendHeartbeat["å‘é€å¿ƒè·³å‘½ä»¤"]
SendHeartbeat --> HandleResult["å¤„ç†ç»“æœ"]
HandleResult --> UpdateUI
```

**å›¾è¡¨æ¥æº**
- [useConnectionManager.ts](file://src/composables/useConnectionManager.ts#L10-L538)

### è¾“å‡ºå†å²é™åˆ¶

ä¸ºé˜²æ­¢å†…å­˜æ³„æ¼ï¼Œç³»ç»Ÿå¯¹ç»ˆç«¯è¾“å‡ºå†å²è®°å½•è¿›è¡Œé™åˆ¶ï¼Œå½“è¾“å‡ºè¡Œæ•°è¶…è¿‡1000è¡Œæ—¶ï¼Œä¿ç•™æœ€è¿‘çš„500è¡Œã€‚

```mermaid
flowchart TD
Start([æ·»åŠ ç»ˆç«¯è¾“å‡º]) --> AddOutput["å°†æ–°è¡Œæ·»åŠ åˆ°terminalOutput"]
AddOutput --> CheckLength["æ£€æŸ¥è¾“å‡ºå†å²é•¿åº¦"]
CheckLength --> IsOverLimit{"é•¿åº¦>1000?"}
IsOverLimit --> |æ˜¯| Truncate["æˆªå–æœ€å500è¡Œ"]
IsOverLimit --> |å¦| KeepAll["ä¿ç•™æ‰€æœ‰è¡Œ"]
Truncate --> UpdateArray["æ›´æ–°terminalOutputæ•°ç»„"]
KeepAll --> End([è¾“å‡ºå†å²æ›´æ–°å®Œæˆ])
UpdateArray --> End
```

**å›¾è¡¨æ¥æº**
- [useConnectionManager.ts](file://src/composables/useConnectionManager.ts#L445-L450)

### è™šæ‹Ÿæ»šåŠ¨ä¸æ‡’åŠ è½½

è™½ç„¶å½“å‰ä»£ç ä¸­æœªç›´æ¥å®ç°è™šæ‹Ÿæ»šåŠ¨æˆ–æ‡’åŠ è½½ï¼Œä½†ç³»ç»Ÿæ¶æ„ä¸ºè¿™äº›æ€§èƒ½ä¼˜åŒ–ç­–ç•¥çš„å®ç°æä¾›äº†åŸºç¡€ã€‚é€šè¿‡åˆ†é¡µåŠ è½½è¿æ¥åˆ—è¡¨å’ŒæŒ‰éœ€æ¸²æŸ“æ ‡ç­¾å†…å®¹ï¼Œå¯ä»¥æœ‰æ•ˆæå‡å¤§é‡æ ‡ç­¾æ—¶çš„æ€§èƒ½è¡¨ç°ã€‚

```mermaid
flowchart TD
Start([å¤§é‡æ ‡ç­¾åœºæ™¯]) --> ImplementVirtualScroll["å®ç°è™šæ‹Ÿæ»šåŠ¨"]
ImplementVirtualScroll --> RenderVisible["ä»…æ¸²æŸ“å¯è§†åŒºåŸŸæ ‡ç­¾"]
RenderVisible --> HandleScroll["æ»šåŠ¨æ—¶åŠ¨æ€æ›´æ–°æ¸²æŸ“"]
HandleScroll --> OptimizePerformance["æ˜¾è‘—æå‡æ€§èƒ½"]
Start --> ImplementLazyLoad["å®ç°æ‡’åŠ è½½"]
ImplementLazyLoad --> LoadOnDemand["æŒ‰éœ€åŠ è½½æ ‡ç­¾å†…å®¹"]
LoadOnDemand --> CacheContent["ç¼“å­˜å·²åŠ è½½å†…å®¹"]
CacheContent --> OptimizePerformance
```

**å›¾è¡¨æ¥æº**
- [TabManager.vue](file://src/components/TabManager.vue#L1-L363)